generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider  = "postgresql"
}

// Users (Admin & Operator)
model User {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String   @unique @db.VarChar(255)
  name       String
  password   String   // Hash with bcrypt
  role       Role
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  posts      Post[]
  
  @@map("user")
}

// Posts
model Post {
  id          BigInt         @id @default(autoincrement())
  title       String         @db.VarChar(500)
  slug        String         @unique @db.VarChar(500)
  excerpt     String?        @db.Text
  content     Json           // JSONB for rich content
  thumbnail   String?        @db.VarChar(500)
  published   Boolean        @default(false)
  createdAt   DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime       @updatedAt @map("updated_at") @db.Timestamptz(6)
  authorId    String         @map("author_id") @db.Uuid
  author      User           @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tags        PostTag[]
  documents   Document[]
  
  @@index([published, createdAt])
  @@index([slug])
  @@map("post")
}

// Tags (Categories)
model Tag {
  id        Int       @id @default(autoincrement())
  name      String    @unique @db.VarChar(100)
  slug      String    @unique @db.VarChar(100)
  type      TagType   @default(CATEGORY)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  posts     PostTag[]
  
  @@map("tag")
}

// Many-to-many relationship between Post and Tag
model PostTag {
  post       Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId     BigInt   @map("post_id")
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  tagId      Int      @map("tag_id")
  assignedAt DateTime @default(now()) @map("assigned_at") @db.Timestamptz(6)
  
  @@id([postId, tagId])
  @@map("post_tag")
}

// Documents (for downloadable files)
model Document {
  id          Int       @id @default(autoincrement())
  title       String    @db.VarChar(500)
  description String?   @db.Text
  fileUrl     String    @map("file_url") @db.VarChar(500)
  fileName    String    @map("file_name") @db.VarChar(255)
  fileSize    Int       @map("file_size") // in bytes
  fileType    String    @map("file_type") @db.VarChar(100) // MIME type
  postId      BigInt?   @map("post_id")
  post        Post?     @relation(fields: [postId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  @@index([postId])
  @@map("document")
}

// Enums
enum Role {
  Admin
  Operator
  
  @@map("role")
}

enum TagType {
  CATEGORY
  ANNOUNCEMENT
  
  @@map("tag_type")
}
